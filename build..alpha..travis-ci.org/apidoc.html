<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/hayes/unpm"

    >unpm (v1.5.0)</a>
</h1>
<h4>private npm registry in node</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm">module unpm</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.unpm">
            function <span class="apidocSignatureSpan"></span>unpm
            <span class="apidocSignatureSpan">(config, User, backend)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.cidr">
            function <span class="apidocSignatureSpan">unpm.</span>cidr
            <span class="apidocSignatureSpan">(unpm)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.config">
            function <span class="apidocSignatureSpan">unpm.</span>config
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.handler">
            function <span class="apidocSignatureSpan">unpm.</span>handler
            <span class="apidocSignatureSpan">(unpm)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.logging">
            function <span class="apidocSignatureSpan">unpm.</span>logging
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.middleware">
            function <span class="apidocSignatureSpan">unpm.</span>middleware
            <span class="apidocSignatureSpan">(middleware, respond, route, unpm, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.toString">
            function <span class="apidocSignatureSpan">unpm.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm.cidr">module unpm.cidr</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.cidr.cidr">
            function <span class="apidocSignatureSpan">unpm.</span>cidr
            <span class="apidocSignatureSpan">(unpm)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm.config">module unpm.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.config.config">
            function <span class="apidocSignatureSpan">unpm.</span>config
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm.handler">module unpm.handler</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.handler.handler">
            function <span class="apidocSignatureSpan">unpm.</span>handler
            <span class="apidocSignatureSpan">(unpm)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm.logging">module unpm.logging</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.logging.logging">
            function <span class="apidocSignatureSpan">unpm.</span>logging
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm.middleware">module unpm.middleware</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.middleware.middleware">
            function <span class="apidocSignatureSpan">unpm.</span>middleware
            <span class="apidocSignatureSpan">(middleware, respond, route, unpm, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.unpm.toString">module unpm.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.unpm.toString.toString">
            function <span class="apidocSignatureSpan">unpm.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm" id="apidoc.module.unpm">module unpm</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.unpm" id="apidoc.element.unpm.unpm">
        function <span class="apidocSignatureSpan"></span>unpm
        <span class="apidocSignatureSpan">(config, User, backend)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unpm(config, User, backend) {
  if(!(this instanceof unpm)) {
    return new unpm(config, User, backend)
  }

  config = add_defaults(config)
  this.router = Router(config.basePathname)
  this.handler = handler(this)
  this.server = http.createServer(this.handler)
  this.log = logging(config)
  this.port = config.port || 8123
  this.config = config
  this.middleware = []
  this.backend = Object.create(config.backend || {})

  if(backend) {
    config.backend = backend
  }

  if(User) {
    config.User = User
  }

  this.Package = Package(this)
  auth(this, config.User)
  cidr(this)

  this.router.add(&#x27;PUT&#x27;, &#x27;/:name&#x27;, controllers.publish)
  this.router.add(&#x27;GET&#x27;, &#x27;/:name/-/:name/:version.tgz&#x27;, controllers.getTarball)
  this.router.add(&#x27;GET&#x27;, &#x27;/:name/:version?&#x27;, controllers.getPackage)
  this.router.add(&#x27;PUT&#x27;, &#x27;/:name/-rev/:rev?&#x27;, controllers.unpublish.some)
  this.router.add(&#x27;DELETE&#x27;, &#x27;/:name/-rev/:rev?&#x27;, controllers.unpublish.all)
  this.router.add(&#x27;DELETE&#x27;, &#x27;/:name/-/:file/-rev/:rev&#x27;, controllers.unpublish.tarball)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.unpm.cidr" id="apidoc.element.unpm.cidr">
        function <span class="apidocSignatureSpan">unpm.</span>cidr
        <span class="apidocSignatureSpan">(unpm)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setup(unpm) {
  if(unpm.config.cidr) {
    unpm.middleware.push(check)
  }

  function check(respond, route, unpm, done) {
    var ip = respond.req.connection.remoteAddress
    var allowed =  cidrCheck.in_range(ip, unpm.config.cidr)

    if(allowed) {
      return done()
    }

    unpm.log.info({ip: ip, message: &#x27;IP out of CIDR range&#x27;})

    respond.res.writeHead(403, {
      &#x27;Content-Type&#x27;: &#x27;application/json&#x27;
    })

    respond.res.end(JSON.stringify({
      error: &#x27;forbidden&#x27;,
      reason: &#x27;invalid ip&#x27;
    }))
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.unpm.config" id="apidoc.element.unpm.config">
        function <span class="apidocSignatureSpan">unpm.</span>config
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">config = function (config) {
  if(config.configfile) {
    add(JSON.parse(fs.readFileSync(path.join(config.configfile))))
  }

  add(JSON.parse(fs.readFileSync(path.join(__dirname, &#x27;config.json&#x27;))))

  return config

  function add(overrides) {
    Object.keys(overrides).forEach(function(key) {
      config[key] = config[key] === undefined ? overrides[key] : config[key]
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.unpm.handler" id="apidoc.element.unpm.handler">
        function <span class="apidocSignatureSpan">unpm.</span>handler
        <span class="apidocSignatureSpan">(unpm)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handler = function (unpm) {
  return function handler(req, res) {
    var route = unpm.router.match(req) || null
    var log = unpm.log

    var respond = responder(req, res, unpm)

    res.on(&#x27;finish&#x27;, function() {
      if(req.headers.authorization) {
        req.headers.authorization = &#x27;Basic ~~removed~~&#x27;
      }

      var info = {
        statusCode: res.statusCode,
        method: req.method,
        url: req.url
      }

      log.info(info)
      log.debug({headers: req.headers})
    })

    if(!unpm.middleware || !unpm.middleware.length) {
      return runRoute()
    }

    runMiddleware(unpm.middleware, respond, route, unpm, runRoute)

    function runRoute(err) {
      if(err) {
        return respond(err)
      }

      if(!route) {
        return respond.notFound()
      }

      route.fn(respond, route, unpm)
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.unpm.logging" id="apidoc.element.unpm.logging">
        function <span class="apidocSignatureSpan">unpm.</span>logging
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function logger(config) {
  var bunyanOptions = {}
  var logDir

  if(!config.verbose &#x26;&#x26; !config.logDir &#x26;&#x26; !config.log) {
    return noopLogger
  }

  bunyanOptions.name = &#x27;unpm&#x27;
  bunyanOptions.streams = []

  if(config.verbose) {
    bunyanOptions.streams.push({
      level: config.log || &#x27;info&#x27;,
      stream: process.stdout
    })
  }

  if(config.logDir || (config.log &#x26;&#x26; !config.verbose)) {
    logDir = config.logDir || process.cwd()

    bunyanOptions.streams.push({
      level: config.log || &#x27;info&#x27;,
      type: &#x27;rotating-file&#x27;,
      period: &#x27;1d&#x27;,
      count: 10,
      path: path.join(logDir, &#x27;unpm.log&#x27;)
    })
  }

  return bunyan.createLogger(bunyanOptions)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.unpm.middleware" id="apidoc.element.unpm.middleware">
        function <span class="apidocSignatureSpan">unpm.</span>middleware
        <span class="apidocSignatureSpan">(middleware, respond, route, unpm, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function runMiddleware(middleware, respond, route, unpm, done) {
  if(!middleware || !middleware.length) {
    return done()
  }

  middleware[0](respond, route, unpm, function(err) {
    if(err) {
      return done(err)
    }

    runMiddleware(middleware.slice(1), respond, route, unpm, done)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.unpm.toString" id="apidoc.element.unpm.toString">
        function <span class="apidocSignatureSpan">unpm.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm.cidr" id="apidoc.module.unpm.cidr">module unpm.cidr</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.cidr.cidr" id="apidoc.element.unpm.cidr.cidr">
        function <span class="apidocSignatureSpan">unpm.</span>cidr
        <span class="apidocSignatureSpan">(unpm)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setup(unpm) {
  if(unpm.config.cidr) {
    unpm.middleware.push(check)
  }

  function check(respond, route, unpm, done) {
    var ip = respond.req.connection.remoteAddress
    var allowed =  cidrCheck.in_range(ip, unpm.config.cidr)

    if(allowed) {
      return done()
    }

    unpm.log.info({ip: ip, message: &#x27;IP out of CIDR range&#x27;})

    respond.res.writeHead(403, {
      &#x27;Content-Type&#x27;: &#x27;application/json&#x27;
    })

    respond.res.end(JSON.stringify({
      error: &#x27;forbidden&#x27;,
      reason: &#x27;invalid ip&#x27;
    }))
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm.config" id="apidoc.module.unpm.config">module unpm.config</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.config.config" id="apidoc.element.unpm.config.config">
        function <span class="apidocSignatureSpan">unpm.</span>config
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">config = function (config) {
  if(config.configfile) {
    add(JSON.parse(fs.readFileSync(path.join(config.configfile))))
  }

  add(JSON.parse(fs.readFileSync(path.join(__dirname, &#x27;config.json&#x27;))))

  return config

  function add(overrides) {
    Object.keys(overrides).forEach(function(key) {
      config[key] = config[key] === undefined ? overrides[key] : config[key]
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm.handler" id="apidoc.module.unpm.handler">module unpm.handler</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.handler.handler" id="apidoc.element.unpm.handler.handler">
        function <span class="apidocSignatureSpan">unpm.</span>handler
        <span class="apidocSignatureSpan">(unpm)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handler = function (unpm) {
  return function handler(req, res) {
    var route = unpm.router.match(req) || null
    var log = unpm.log

    var respond = responder(req, res, unpm)

    res.on(&#x27;finish&#x27;, function() {
      if(req.headers.authorization) {
        req.headers.authorization = &#x27;Basic ~~removed~~&#x27;
      }

      var info = {
        statusCode: res.statusCode,
        method: req.method,
        url: req.url
      }

      log.info(info)
      log.debug({headers: req.headers})
    })

    if(!unpm.middleware || !unpm.middleware.length) {
      return runRoute()
    }

    runMiddleware(unpm.middleware, respond, route, unpm, runRoute)

    function runRoute(err) {
      if(err) {
        return respond(err)
      }

      if(!route) {
        return respond.notFound()
      }

      route.fn(respond, route, unpm)
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm.logging" id="apidoc.module.unpm.logging">module unpm.logging</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.logging.logging" id="apidoc.element.unpm.logging.logging">
        function <span class="apidocSignatureSpan">unpm.</span>logging
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function logger(config) {
  var bunyanOptions = {}
  var logDir

  if(!config.verbose &#x26;&#x26; !config.logDir &#x26;&#x26; !config.log) {
    return noopLogger
  }

  bunyanOptions.name = &#x27;unpm&#x27;
  bunyanOptions.streams = []

  if(config.verbose) {
    bunyanOptions.streams.push({
      level: config.log || &#x27;info&#x27;,
      stream: process.stdout
    })
  }

  if(config.logDir || (config.log &#x26;&#x26; !config.verbose)) {
    logDir = config.logDir || process.cwd()

    bunyanOptions.streams.push({
      level: config.log || &#x27;info&#x27;,
      type: &#x27;rotating-file&#x27;,
      period: &#x27;1d&#x27;,
      count: 10,
      path: path.join(logDir, &#x27;unpm.log&#x27;)
    })
  }

  return bunyan.createLogger(bunyanOptions)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm.middleware" id="apidoc.module.unpm.middleware">module unpm.middleware</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.middleware.middleware" id="apidoc.element.unpm.middleware.middleware">
        function <span class="apidocSignatureSpan">unpm.</span>middleware
        <span class="apidocSignatureSpan">(middleware, respond, route, unpm, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function runMiddleware(middleware, respond, route, unpm, done) {
  if(!middleware || !middleware.length) {
    return done()
  }

  middleware[0](respond, route, unpm, function(err) {
    if(err) {
      return done(err)
    }

    runMiddleware(middleware.slice(1), respond, route, unpm, done)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.unpm.toString" id="apidoc.module.unpm.toString">module unpm.toString</a></h1>


    <h2>
        <a href="#apidoc.element.unpm.toString.toString" id="apidoc.element.unpm.toString.toString">
        function <span class="apidocSignatureSpan">unpm.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
